# Calendar Mirror #

Calendar Mirror is a simple rust project to display the contents of a
user's google calendar on a PaPiRus ePaper display on a Raspberry Pi.

## Hardware ##

This project has been developed for a Raspberry Pi 3 B+ running with a
2.7" PaPiRus ePaper HAT module. Other Raspberry Pi versions (apart
from the Raspberry Pi Zero) might also suffice. Smaller versions of
the PaPiRus HAT might also be compatible if some changes to the
rendering code are made(you will need to change the value of the
SCREEN\_DIMS constant in cal_display.rs) --- however the lack of
screen space will prove limiting.

Assemble the hardware as described
[here](https://learn.pi-supply.com/make/papirus-assembly-tips-and-gotchas/). That
website refers to a pogo pin, but it is not required for this project.

## Operating System and Drivers ##

The OS was Raspbian Stretch. No other OS versions have been
tested. However it's likely that the code will run on other operating
systems with few if any changes.

The following are the list of software dependencies required to
compile and run this project:

1. Operating System: Raspbian, (the version tested is based on Debian
   Stretch). The list of packages installed on the Raspberry Pi can be
   found at
   <http://hourglassapps.com/calendar_mirror/packages.txt>. This list
   was generated by entering the dpkg --get-selections
   command. Conversely the same packages can be installed by download
   the list above and from within the download directory, enter:

```sudo dpkg --set-selections < packages.txt
```

2. [PaPiRus drivers](https://github.com/PiSupply/PaPiRus). Install
   these as described in the link.

## Compilation, Installation & Configuration Setup ##

### Compilation ###

Calendar Mirror can be compiled with the stable rust
toolchain. Install the rust toolchain on your Raspberry Pi as
described on the [Rust](https://www.rust-lang.org/) website.

Clone the Calendar Mirror repository with the command:

`git clone ...`

Change to the directory containing the cloned project and enter:

`cargo build`

### Configuration Setup ###

Calendar Mirror is designed to run on a system where all partitions
have been mounted read-only by default. Application configuration is
saved on a dedicated ext4 partition. Normally this partition is also
mounted read-only, but when a change needs to be saved it is
temporarily remounted in read-write mode. 

You will now need to create this configuration partition:

Create a new small Linux partition (around 7 Mib in size) on your
SD-Card. If there isn't sufficient free space in your patition table
you might need to shrink one of your existing partitions first to
create some free space using an application such as GParted. You will
need to ensure that the partition is not mounted before shrinking
it. Shrinking the root partition, if required, must be done from a
different device as it cannot be unmounted.

On the new partition, create an ext4 filesystem with the mkfs command.

### Installation ###

Install the binary and related resources with:

`sudo ./target/debug/calendar_mirror --install`

## Filesystem Configuration ##

To protect against filesystem corruption that could be caused by power
interruptions it is prudent to ensure that any mounted partitions are
read-only. A tmpfs overlay allows programs that require read-write
access to the filesystem for logging etc. to operate as normal.

More information on how to accomplish both tasks can be found on the
[raspberrypi
forums](https://www.raspberrypi.org/forums/viewtopic.php?p=1044893).

Finally update your /etc/fstab to mount /boot as readonly by default
and the configuration partition you created above as read-write. An
example fstab file (where /dev/mmcblk0p8 is the device corresponding
to the configuration partition) can be found .

### Read-Only Root Filesystem ###

